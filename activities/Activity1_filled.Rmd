---
title: "Activity 1"
author: "Brooke Wolford"
date: "2025-04-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Activity 1

### Pair programming

Pair programming is a technique where two programmers work together at one workstation. One programmer, the driver, writes the code, while the other, the navigator, reviews the code as it's being written and offers suggestions. The goal is to learn from each other. It's best practice to switch driver and navigator roles roughly every 10 minutes or whenever you come to a natural break point.

### Objective: Use information from Module 1 and Module 2 to read in sensitive data 

For the hands-on application of what you've been learning, we are going to use artificial data sets from the United Kingdom's National Health Service. These are downloaded from [here](https://digital.nhs.uk/services/artificial-data).

We need a data dictionary to understand what the columns represent. We are focusing on the admitted patient care data today. Use the excel file HES+TOS+V2.04 and use the HES APC TOS tab.

We are using the sample which is 10,000 rows instead of 1 million rows in the "full" dataset. This is due to time and memory constraints on the lab, but you could absolutely do this type of analysis on large sensitive data like the full sample available.

First, we need to go to Terminal and copy the data from a shared folder to your own folder. Remember to replace `$USER` with your username.
`cp -r /mnt/work/data/artificial_hes_apc_202302_v1_sample/ /mnt/work/workbench/$USER/`

```{r}
##call libraries
#library(c(tidyr,dplyr,readr,ggplot2))
library(tidyr)
library(dplyr)
library(readr)
library(ggplot2)


data_dir<-"activities/artificial_hes_apc_0102.csv"


#read in .csv
df<-read_csv(data_dir)

glimpse(df)
head(df)
```

Let's focus on the diagnoses (DIAG_3_01) the admission date (ADMIDATE); the discharge date (DISDATE); Date of Birth (MYDOB); and sex (SEX). What are the first steps we would take if we want to study what diagnoses are associated with a longer hospital admission time?

The tibble shows the dates in a "Date" class. To manipualte dates we can use the `Sys.Date` functionality or we can use the `lubridate` package but there is also `clock` which offers a "tidy" way of [managing dates and times](https://www.tidyverse.org/blog/2021/03/clock-0-1-0/).

```{r}

#make a smaller dataset to work with
sub<-df %>% select(DIAG_3_01, ADMIDATE, DISDATE,PSEUDO_HESID,MYDOB, SEX)

#calculate number of days someone was admitted
sub<-sub %>% mutate(duration=as.numeric(DISDATE-ADMIDATE))

#how many different diagnoses do we have in the dataset?
sub %>% summarise(unique_count = n_distinct(DIAG_3_01))
 
#which diagnosis is most frequent?
sub %>% group_by(DIAG_3_01) %>% summarize(count=n()) %>% arrange(desc(count))

#create a histogram of the diagnoses
sub %>% ggplot(aes(DIAG_3_01)) + geom_bar()
sub %>% group_by(DIAG_3_01) %>% 
  summarize(diag_count=n()) %>% 
  ggplot(aes(diag_count)) + geom_histogram()

#create a histogram of the duration of admission
sub %>% group_by(duration) %>% summarize(duration_count=n()) %>% 
  ggplot(aes(duration_count)) + geom_histogram(binwidth=2) + xlim(0,50)

sub %>% group_by(duration) %>% summarize(duration_count=n()) 

#how can you calculate the age at admission using the month and year DOB? Note the latter is in a character format instead of a date format
library(lubridate)
sub2 <- sub %>% mutate(birth_date = as_date(MYDOB, format = "%m%Y")) %>% 
  mutate(age_admit = ADMIDATE - birth_date) %>% 
  mutate(age_admit_years = as.numeric(age_admit)/365.25)

sub2  %>% ggplot(aes(age_admit_years)) + geom_histogram()

```

This data could be used to ask a lot of questions. What kind of hypotheses do you have based on what you have seen so far? Think about what you might like to research using AI methods. We will continue with this dataset in the next two activities.
